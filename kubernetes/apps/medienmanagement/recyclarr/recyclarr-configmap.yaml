apiVersion: v1
kind: ConfigMap
metadata:
  name: recyclarr-configmap
  namespace: medienmanagement
data:
  recyclarr.yml: |
    sonarr:
      sonarr:
        base_url: http://sonarr.medienmanagement.svc.cluster.local:8989
        api_key: !env_var SONARR__AUTH__APIKEY
        delete_old_custom_formats: true
        replace_existing_custom_formats: true

        include:
          - template: sonarr-quality-definition-series
          - template: sonarr-v4-quality-profile-hd-bluray-web-german
          - template: sonarr-v4-custom-formats-hd-bluray-web-german
          - template: sonarr-v4-quality-profile-hd-remux-web-german
          - template: sonarr-v4-custom-formats-hd-remux-web-german

        # Erzwingt Deutsch-Audio (wenn es keine passende DE-Version gibt, wird nicht "irgendwas" genommen)
        quality_profiles:
          - name: HD Bluray + WEB (GER)
            min_format_score: 10000
          - name: HD Remux + WEB (GER)
            min_format_score: 10000

        # Codec-Priorität: AV1 > H.265/HEVC > H.264/AVC
        # (TRaSH bewertet AV1 standardmäßig negativ; hier wird es bewusst bevorzugt)
        custom_formats:
          - trash_ids:
              - 15a05bc7c1a36e2b57fd628f8977e2fc # AV1 :contentReference[oaicite:0]{index=0}
            assign_scores_to:
              - name: HD Bluray + WEB (GER)
                score: 5000
              - name: HD Remux + WEB (GER)
                score: 5000

          - trash_ids:
              - c9eafd50846d299b862ca9bb6ea91950 # x265 / HEVC :contentReference[oaicite:1]{index=1}
            assign_scores_to:
              - name: HD Bluray + WEB (GER)
                score: 2000
              - name: HD Remux + WEB (GER)
                score: 2000

          - trash_ids:
              - cddfb4e32db826151d97352b8e37c648 # x264 / AVC :contentReference[oaicite:2]{index=2}
            assign_scores_to:
              - name: HD Bluray + WEB (GER)
                score: -2000
              - name: HD Remux + WEB (GER)
                score: -2000

    radarr:
      radarr:
        base_url: http://radarr.medienmanagement.svc.cluster.local:7878
        api_key: !env_var RADARR__AUTH__APIKEY
        delete_old_custom_formats: true
        replace_existing_custom_formats: true

        include:
          - template: radarr-quality-definition-movie
          - template: radarr-quality-profile-hd-bluray-web-german
          - template: radarr-custom-formats-hd-bluray-web-german

        # Erzwingt Deutsch-Audio
        quality_profiles:
          - name: HD Bluray + WEB (GER)
            min_format_score: 10000

        # Codec-Priorität: AV1 > H.265/HEVC > H.264/AVC
        custom_formats:
          - trash_ids:
              - 15a05bc7c1a36e2b57fd628f8977e2fc # AV1 :contentReference[oaicite:3]{index=3}
            assign_scores_to:
              - name: HD Bluray + WEB (GER)
                score: 5000

          - trash_ids:
              - c9eafd50846d299b862ca9bb6ea91950 # x265 / HEVC :contentReference[oaicite:4]{index=4}
            assign_scores_to:
              - name: HD Bluray + WEB (GER)
                score: 2000

          - trash_ids:
              - cddfb4e32db826151d97352b8e37c648 # x264 / AVC :contentReference[oaicite:5]{index=5}
            assign_scores_to:
              - name: HD Bluray + WEB (GER)
                score: -2000
